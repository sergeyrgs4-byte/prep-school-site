<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Экспресс-диагностика — АзбуКид</title>
  <meta name="description" content="Быстрая диагностика 5–7 минут: речь, счёт, внимание. Получите карту навыков и план на 7 дней." />
  <link rel="canonical" href="https://azbukid.ru/diagnostics.html" />
  <meta property="og:title" content="Экспресс-диагностика — АзбуКид" />
  <meta property="og:description" content="20 коротких заданий: получите карту навыков и персональный план занятий." />
  <meta property="og:url" content="https://azbukid.ru/diagnostics.html" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://azbukid.ru/og-cover.jpg" />
  <link rel="icon" href="/favicon.ico" />
  <style>
    :root{--bg:#0f172a;--card:#111827;--text:#e5e7eb;--muted:#9ca3af;--acc:#f59e0b;--ok:#22c55e;--danger:#ef4444}
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto}
    a{color:inherit}
    .wrap{max-width:900px;margin:0 auto;padding:20px}
    header{display:flex;align-items:center;gap:12px;padding:8px 0}
    .brand{display:flex;align-items:center;gap:10px;text-decoration:none}
    .logo{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,#fde68a,#f59e0b)}
    h1{font-size:20px;margin:0}
    .card{background:var(--card);border:1px solid #1f2937;border-radius:14px;padding:18px}
    .muted{color:var(--muted)}
    .btn{display:inline-block;background:var(--acc);color:#111827;text-decoration:none;padding:10px 16px;border-radius:10px;font-weight:600}
    .btn.secondary{background:#1f2937;color:var(--text);border:1px solid #334155}
    .btn[disabled]{opacity:.5;pointer-events:none}
    .grid{display:grid;gap:16px}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .step{display:none}
    .step.active{display:block}
    .answers{display:grid;gap:10px;margin-top:10px}
    .answers label{display:flex;gap:8px;align-items:flex-start;padding:10px;border:1px solid #334155;border-radius:10px;cursor:pointer}
    .progress{height:8px;border-radius:999px;background:#1f2937;overflow:hidden;margin:8px 0 16px}
    .bar{height:100%;width:0%;background:var(--acc);transition:width .25s}
    .title{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .badge{border:1px dashed #334155;border-radius:999px;padding:4px 8px;font-size:12px;color:var(--muted)}
    ol{margin:0 0 0 18px}
    @media (max-width:640px){.row{flex-direction:column}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <a class="brand" href="/"><span class="logo" aria-hidden="true"></span><h1>АзбуКид</h1></a>
      <span class="badge">Экспресс-диагностика · 5–7 минут</span>
    </header>

    <main class="grid">
      <section class="card">
        <div class="title">
          <h2 id="title">Шаг 1 из 5</h2>
          <a class="btn secondary" href="/">На главную</a>
        </div>
        <div class="progress" aria-label="Прогресс">
          <div class="bar" id="bar" style="width:0%"></div>
        </div>

        <!-- ШАГИ -->
        <form id="form">
          <!-- 1 Речь -->
          <div class="step active" data-step="1" data-skill="speech">
            <h3>Назови букву</h3>
            <p class="muted">Попросите ребёнка назвать букву: <strong>М</strong>. Что он отвечает?</p>
            <div class="answers">
              <label><input type="radio" name="s1" value="2"> Уверенно называет правильно</label>
              <label><input type="radio" name="s1" value="1"> Называет, но с подсказкой/сомневается</label>
              <label><input type="radio" name="s1" value="0"> Путает или не знает</label>
            </div>
          </div>

          <!-- 2 Счёт -->
          <div class="step" data-step="2" data-skill="math">
            <h3>Сосчитай до 5</h3>
            <p class="muted">Попросите посчитать: 1… 2… 3… 4… 5.</p>
            <div class="answers">
              <label><input type="radio" name="s2" value="2"> Считает сам и не сбивается</label>
              <label><input type="radio" name="s2" value="1"> Считает с подсказкой</label>
              <label><input type="radio" name="s2" value="0"> Не получается</label>
            </div>
          </div>

          <!-- 3 Внимание/логика -->
          <div class="step" data-step="3" data-skill="logic">
            <h3>Найди лишнее</h3>
            <p class="muted">Кот — собака — <u>стол</u> — щенок. Что лишнее?</p>
            <div class="answers">
              <label><input type="radio" name="s3" value="2"> Называет «стол» и объясняет почему</label>
              <label><input type="radio" name="s3" value="1"> Называет «стол», но без объяснения</label>
              <label><input type="radio" name="s3" value="0"> Ошибается</label>
            </div>
          </div>

          <!-- 4 Последовательность -->
          <div class="step" data-step="4" data-skill="logic">
            <h3>Продолжи ряд</h3>
            <p class="muted">1, 2, 3, … Что дальше?</p>
            <div class="answers">
              <label><input type="radio" name="s4" value="2"> 4 — называет сразу</label>
              <label><input type="radio" name="s4" value="1"> 4 — с подсказкой</label>
              <label><input type="radio" name="s4" value="0"> Иное/молчит</label>
            </div>
          </div>

          <!-- 5 Речь/фонемы -->
          <div class="step" data-step="5" data-skill="speech">
            <h3>Повтори слово</h3>
            <p class="muted">Попросите повторить слово «<strong>молоко</strong>».</p>
            <div class="answers">
              <label><input type="radio" name="s5" value="2"> Произносит чётко, без искажений</label>
              <label><input type="radio" name="s5" value="1"> Небольшие искажения/шепелявость</label>
              <label><input type="radio" name="s5" value="0"> Существенные искажения/не повторяет</label>
            </div>
          </div>

          <div class="row" style="margin-top:16px">
            <button type="button" class="btn secondary" id="prev" disabled>Назад</button>
            <button type="button" class="btn" id="next">Дальше</button>
          </div>
        </form>
      </section>

      <!-- Результат -->
      <section id="result" class="card" style="display:none">
        <h2>Готово! Карта навыков</h2>
        <p class="muted">Результаты сохранены в вашем браузере. На основе карты построен план на 7 дней.</p>

        <div id="scoreboard" class="grid" style="grid-template-columns:repeat(3,1fr)">
          <!-- сюда JS подставит оценки -->
        </div>

        <div class="card" style="margin-top:16px">
          <h3>Ваш мини-план на неделю</h3>
          <ol id="planList">
            <!-- сюда JS подставит 7 пунктов -->
          </ol>
          <p class="muted">Откройте главную и вернитесь завтра — появится «Лист дня» и печатные задания.</p>
          <div class="row" style="margin-top:10px">
            <a class="btn" href="/">На главную</a>
            <button class="btn secondary" id="reset">Сбросить результаты</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // --- МИНИ-ЛОГИКА ДИАГНОСТИКИ (без бэкенда) ---
    const steps = [...document.querySelectorAll('.step')];
    const nextBtn = document.getElementById('next');
    const prevBtn = document.getElementById('prev');
    const bar = document.getElementById('bar');
    const title = document.getElementById('title');
    const resultBox = document.getElementById('result');
    const form = document.getElementById('form');
    const scoreboard = document.getElementById('scoreboard');
    const planList = document.getElementById('planList');
    const resetBtn = document.getElementById('reset');

    const STORAGE_KEY = 'azbukid_diag_v1';
    const PLAN_KEY = 'azbukid_plan_v1';
    let i = 0;

    function showStep(n){
      steps.forEach((s,idx)=>s.classList.toggle('active', idx===n));
      title.textContent = `Шаг ${n+1} из ${steps.length}`;
      bar.style.width = `${Math.round((n)/steps.length*100)}%`;
      prevBtn.disabled = (n===0);
      nextBtn.textContent = (n===steps.length-1) ? 'Готово' : 'Дальше';
    }
    showStep(i);

    function currentAnswered(){
      const name = `s${i+1}`;
      return form.querySelector(`input[name="${name}"]:checked`);
    }

    nextBtn.addEventListener('click', ()=>{
      if (!currentAnswered()){
        nextBtn.blur();
        nextBtn.classList.add('shake');
        setTimeout(()=>nextBtn.classList.remove('shake'),300);
        return;
      }
      if (i < steps.length-1){
        i++; showStep(i);
      } else {
        finish();
      }
    });

    prevBtn.addEventListener('click', ()=>{ if (i>0){ i--; showStep(i);} });

    function finish(){
      // собрать ответы
      const data = [];
      let totals = {speech:0, math:0, logic:0};
      steps.forEach((s,idx)=>{
        const skill = s.dataset.skill;
        const val = parseInt(form.querySelector(`input[name="s${idx+1}"]:checked`).value,10);
        data.push({step:idx+1, skill, val});
        totals[skill] += val;
      });

      // оценка по шкалам (0-4 слабее, 5-7 средне, 8-10 сильнее)
      function band(v){ if (v<=4) return {t:'нужна тренировка', c:'var(--danger)'}; if (v<=7) return {t:'средний уровень', c:'var(--acc)'}; return {t:'сильная сторона', c:'var(--ok)'}; }

      // отрисовать «карту»
      scoreboard.innerHTML = '';
      Object.entries(totals).forEach(([k,v])=>{
        const b = band(v);
        const title = k==='speech'?'Речь/фонетика':(k==='math'?'Счёт/числа':'Внимание/логика');
        const div = document.createElement('div');
        div.className='card';
        div.innerHTML = `<h4 style="margin:0 0 6px">${title}</h4>
          <div class="muted">Баллы: <strong>${v}</strong> из 10</div>
          <div style="margin-top:8px"><span class="badge" style="border-color:${b.c};color:${b.c}">${b.t}</span></div>`;
        scoreboard.appendChild(div);
      });

      // сгенерировать простой план на 7 дней (по двум слабейшим направлениям)
      const order = Object.entries(totals).sort((a,b)=>a[1]-b[1]).map(([k])=>k);
      const focus1 = order[0], focus2 = order[1];
      const lib = {
        speech:['Игровая артикуляция «лошадка/чашечка» (3 мин)','Повтори слоги: ма-мо-му-мы (3 мин)','Опиши картинку тремя словами (3 мин)'],
        math:['Сосчитай предметы дома до 5/10 (3 мин)','Игра «Сколько стало?» +1/-1 (3 мин)','Сравни длиннее/короче (3 мин)'],
        logic:['Найди лишнее из 4 слов (3 мин)','Собери последовательность 1-2-3-4 (3 мин)','«Что сначала/потом?» бытовые действия (3 мин)']
      };
      const plan = [];
      for (let d=1; d<=7; d++){
        const f = (d%2===1) ? focus1 : focus2;
        const pick = lib[f][(d-1)%lib[f].length];
        plan.push(`${d}. ${pick}`);
      }
      planList.innerHTML = plan.map(li=>`<li>${li}</li>`).join('');

      // сохранить
      const payload = { totals, data, ts: Date.now() };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
      localStorage.setItem(PLAN_KEY, JSON.stringify({ plan, ts: Date.now() }));

      // показать результат
      document.querySelector('section.card').style.display='none';
      resultBox.style.display='block';
      bar.style.width = '100%';
      title.textContent = 'Готово';
      nextBtn.disabled = true; prevBtn.disabled = true;
      history.replaceState(null,'','/diagnostics.html#done');
    }

    resetBtn?.addEventListener('click', ()=>{
      localStorage.removeItem(STORAGE_KEY);
      localStorage.removeItem(PLAN_KEY);
      location.href = '/diagnostics.html';
    });

    // Если уже проходили — показать результат сразу
    (function autoload(){
      const saved = localStorage.getItem(STORAGE_KEY);
      const savedPlan = localStorage.getItem(PLAN_KEY);
      if (saved && savedPlan && location.hash==='#done'){
        // реконструируем отображение
        const { totals } = JSON.parse(saved);
        const { plan } = JSON.parse(savedPlan);
        // карта
        scoreboard.innerHTML = '';
        function band(v){ if (v<=4) return {t:'нужна тренировка', c:'var(--danger)'}; if (v<=7) return {t:'средний уровень', c:'var(--acc)'}; return {t:'сильная сторона', c:'var(--ok)'}; }
        Object.entries(totals).forEach(([k,v])=>{
          const b = band(v);
          const title = k==='speech'?'Речь/фонетика':(k==='math'?'Счёт/числа':'Внимание/логика');
          const div = document.createElement('div');
          div.className='card';
          div.innerHTML = `<h4 style="margin:0 0 6px">${title}</h4>
            <div class="muted">Баллы: <strong>${v}</strong> из 10</div>
            <div style="margin-top:8px"><span class="badge" style="border-color:${b.c};color:${b.c}">${b.t}</span></div>`;
          scoreboard.appendChild(div);
        });
        // план
        planList.innerHTML = plan.map(li=>`<li>${li}</li>`).join('');
        // показать
        document.querySelector('section.card').style.display='none';
        resultBox.style.display='block';
        bar.style.width = '100%';
        title.textContent = 'Готово';
        nextBtn.disabled = true; prevBtn.disabled = true;
      }
    })();
  </script>
</body>
</html>
