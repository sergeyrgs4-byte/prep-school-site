<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Экспресс-диагностика — АзбуКид</title>
  <meta name="description" content="15 коротких заданий — речь/язык, счёт/числа, логика/внимание и графомоторика. Получите карту навыков и мини-план на неделю." />
  <link rel="canonical" href="https://azbukid.ru/diagnostics.html" />
  <meta property="og:title" content="Экспресс-диагностика — АзбуКид" />
  <meta property="og:description" content="Результативный тест на 5 минут: сильные и зоны роста ребёнка + план занятий на 7 дней." />
  <meta property="og:url" content="https://azbukid.ru/diagnostics.html" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://azbukid.ru/og-cover.jpg" />
  <link rel="icon" href="/favicon.ico" />
  <style>
    :root{--bg:#0f172a;--card:#111827;--text:#e5e7eb;--muted:#9ca3af;--acc:#f59e0b;--ok:#22c55e;--danger:#ef4444;--line:#1f2937}
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto}
    a{color:inherit}
    .wrap{max-width:980px;margin:0 auto;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:6px 0}
    .brand{display:flex;align-items:center;gap:10px;text-decoration:none}
    .logo{width:28px;height:28px;border-radius:8px;background:linear-gradient(135deg,#fde68a,#f59e0b)}
    h1{font-size:20px;margin:0}
    .badge{border:1px dashed #334155;border-radius:999px;padding:4px 10px;font-size:12px;color:var(--muted)}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:18px}
    .muted{color:var(--muted)}
    .btn{display:inline-block;background:var(--acc);color:#111827;text-decoration:none;padding:10px 16px;border-radius:10px;font-weight:600}
    .btn.secondary{background:#1f2937;color:var(--text);border:1px solid #334155}
    .btn[disabled]{opacity:.5;pointer-events:none}
    .grid{display:grid;gap:16px}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .step{display:none}
    .step.active{display:block}
    .answers{display:grid;gap:10px;margin-top:10px}
    .answers label{display:flex;gap:8px;align-items:flex-start;padding:10px;border:1px solid #334155;border-radius:10px;cursor:pointer}
    .progress{height:8px;border-radius:999px;background:#1f2937;overflow:hidden;margin:8px 0 16px}
    .bar{height:100%;width:0%;background:var(--acc);transition:width .25s}
    .title{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .kpi{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    .kpi .tile{border:1px solid var(--line);border-radius:12px;padding:12px}
    .pill{border:1px solid #334155;border-radius:999px;padding:2px 8px;font-size:12px}
    .good{color:var(--ok);border-color:var(--ok)}
    .warn{color:var(--acc);border-color:var(--acc)}
    .bad{color:var(--danger);border-color:var(--danger)}
    .report{display:grid;gap:16px}
    .cols{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .print{float:right}
    @media (max-width:760px){
      .kpi{grid-template-columns:1fr 1fr}
      .cols{grid-template-columns:1fr}
    }
    @media print{
      body{background:#fff;color:#000}
      .card{border-color:#ddd}
      .btn,.print,.badge{display:none}
      a{text-decoration:none}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <a class="brand" href="/"><span class="logo" aria-hidden="true"></span><h1>АзбуКид</h1></a>
      <span class="badge">Диагностика · ~5 минут · 15 заданий</span>
    </header>

    <main class="grid">
      <section class="card">
        <div class="title">
          <h2 id="title">Шаг 1 из 15</h2>
          <div class="row">
            <a class="btn secondary" href="/">На главную</a>
            <button class="btn secondary print" onclick="window.print()">Печать / PDF</button>
          </div>
        </div>
        <p class="muted" style="margin-top:-6px">Отвечайте за ребёнка по наблюдениям сейчас. Где «с подсказкой» — можно повторить вопрос или слегка направить.</p>
        <div class="progress" aria-label="Прогресс"><div class="bar" id="bar" style="width:0%"></div></div>

        <!-- ====== ШАГИ (15) ====== -->
        <form id="form">
          <!-- РЕЧЬ / ЯЗЫК — 5 -->
          <div class="step active" data-step="1" data-skill="speech">
            <h3>Назови букву</h3>
            <p class="muted">Скажите: <strong>Это буква М. Как она называется?</strong></p>
            <div class="answers">
              <label><input type="radio" name="s1" value="2"> Уверенно «М»</label>
              <label><input type="radio" name="s1" value="1"> С подсказкой/сомневается</label>
              <label><input type="radio" name="s1" value="0"> Путает/не знает</label>
            </div>
          </div>

          <div class="step" data-step="2" data-skill="speech">
            <h3>Первый звук</h3>
            <p class="muted">Что начинается на <strong>М</strong>: мыло, сыр, мяч?</p>
            <div class="answers">
              <label><input type="radio" name="s2" value="2"> Верно и объясняет</label>
              <label><input type="radio" name="s2" value="1"> Верно без объяснения</label>
              <label><input type="radio" name="s2" value="0"> Ошибка</label>
            </div>
          </div>

          <div class="step" data-step="3" data-skill="speech">
            <h3>Сложи слоги</h3>
            <p class="muted">Скажите по слогам: <strong>ко + ша = ?</strong></p>
            <div class="answers">
              <label><input type="radio" name="s3" value="2"> Правильно (кошка)</label>
              <label><input type="radio" name="s3" value="1"> Близко, неуверенно</label>
              <label><input type="radio" name="s3" value="0"> Не получается</label>
            </div>
          </div>

          <div class="step" data-step="4" data-skill="speech">
            <h3>Повтори предложение</h3>
            <p class="muted">Повтори: <strong>Кошка спит на ковре</strong>.</p>
            <div class="answers">
              <label><input type="radio" name="s4" value="2"> Полностью верно</label>
              <label><input type="radio" name="s4" value="1"> Теряет 1 слово/меняет порядок</label>
              <label><input type="radio" name="s4" value="0"> Не повторяет</label>
            </div>
          </div>

          <div class="step" data-step="5" data-skill="speech">
            <h3>Понимание инструкции</h3>
            <p class="muted">Попросите: <strong>Положи карандаш на стол, а книгу — под стол</strong> (двухступенчатая инструкция).</p>
            <div class="answers">
              <label><input type="radio" name="s5" value="2"> Выполняет обе части без подсказки</label>
              <label><input type="radio" name="s5" value="1"> Выполняет с подсказкой/ошибкой</label>
              <label><input type="radio" name="s5" value="0"> Не выполняет</label>
            </div>
          </div>

          <!-- СЧЁТ / ЧИСЛА — 4 -->
          <div class="step" data-step="6" data-skill="math">
            <h3>Счёт до 6</h3>
            <p class="muted">Попросите сосчитать: 1… 6.</p>
            <div class="answers">
              <label><input type="radio" name="s6" value="2"> Сам, без ошибок</label>
              <label><input type="radio" name="s6" value="1"> С подсказкой</label>
              <label><input type="radio" name="s6" value="0"> Не получается</label>
            </div>
          </div>

          <div class="step" data-step="7" data-skill="math">
            <h3>Где больше?</h3>
            <p class="muted">Где больше: <strong>3</strong> или <strong>5</strong>?</p>
            <div class="answers">
              <label><input type="radio" name="s7" value="2"> 5 — уверенно</label>
              <label><input type="radio" name="s7" value="1"> 5 — с подсказкой</label>
              <label><input type="radio" name="s7" value="0"> Неверно</label>
            </div>
          </div>

          <div class="step" data-step="8" data-skill="math">
            <h3>Добавь один</h3>
            <p class="muted">Если было <strong>4</strong>, добавим один — сколько станет?</p>
            <div class="answers">
              <label><input type="radio" name="s8" value="2"> 5 — сразу</label>
              <label><input type="radio" name="s8" value="1"> 5 — с подсказкой</label>
              <label><input type="radio" name="s8" value="0"> Неверно</label>
            </div>
          </div>

          <div class="step" data-step="9" data-skill="math">
            <h3>Состав числа</h3>
            <p class="muted">Покажите 5 предметов: «Если убрали один, сколько осталось?»</p>
            <div class="answers">
              <label><input type="radio" name="s9" value="2"> 4 — сразу, без пересчёта</label>
              <label><input type="radio" name="s9" value="1"> 4 — с пересчётом/подсказкой</label>
              <label><input type="radio" name="s9" value="0"> Ошибка</label>
            </div>
          </div>

          <!-- ЛОГИКА / ВНИМАНИЕ — 4 -->
          <div class="step" data-step="10" data-skill="logic">
            <h3>Продолжи ряд (ABAB)</h3>
            <p class="muted">Круг, квадрат, круг, квадрат… что дальше?</p>
            <div class="answers">
              <label><input type="radio" name="s10" value="2"> Круг — уверенно</label>
              <label><input type="radio" name="s10" value="1"> Круг — с подсказкой</label>
              <label><input type="radio" name="s10" value="0"> Неверно</label>
            </div>
          </div>

          <div class="step" data-step="11" data-skill="logic">
            <h3>Найди лишнее</h3>
            <p class="muted">Кот — собака — <u>стол</u> — щенок. Что лишнее?</p>
            <div class="answers">
              <label><input type="radio" name="s11" value="2"> «Стол» + объяснение</label>
              <label><input type="radio" name="s11" value="1"> «Стол» без объяснения</label>
              <label><input type="radio" name="s11" value="0"> Ошибка</label>
            </div>
          </div>

          <div class="step" data-step="12" data-skill="logic">
            <h3>Последовательность</h3>
            <p class="muted">1, 2, 3, … Что дальше?</p>
            <div class="answers">
              <label><input type="radio" name="s12" value="2"> 4 — сразу</label>
              <label><input type="radio" name="s12" value="1"> 4 — с подсказкой</label>
              <label><input type="radio" name="s12" value="0"> Неверно</label>
            </div>
          </div>

          <div class="step" data-step="13" data-skill="logic">
            <h3>Слуховое внимание</h3>
            <p class="muted">Попросите хлопнуть, когда услышит звук «а» в цепочке: <em>м-а-ма</em>.</p>
            <div class="answers">
              <label><input type="radio" name="s13" value="2"> Реагирует верно</label>
              <label><input type="radio" name="s13" value="1"> Ошибается 1 раз</label>
              <label><input type="radio" name="s13" value="0"> Не различает</label>
            </div>
          </div>

          <!-- ГРАФОМОТОРИКА — 2 -->
          <div class="step" data-step="14" data-skill="motor">
            <h3>Обводка по линии</h3>
            <p class="muted">Попросите обвести простую линию карандашом (волнистую/прямую).</p>
            <div class="answers">
              <label><input type="radio" name="s14" value="2"> Аккуратно, почти без выходов</label>
              <label><input type="radio" name="s14" value="1"> С выходами, но старается</label>
              <label><input type="radio" name="s14" value="0"> Сильно выходит/не получается</label>
            </div>
          </div>

          <div class="step" data-step="15" data-skill="motor">
            <h3>Удержание карандаша</h3>
            <p class="muted">Как держит карандаш при рисовании?</p>
            <div class="answers">
              <label><input type="radio" name="s15" value="2"> Щипцевой захват (правильно)</label>
              <label><input type="radio" name="s15" value="1"> Неустойчивый/ладонный, но старается</label>
              <label><input type="radio" name="s15" value="0"> Держит неправильно, контролировать сложно</label>
            </div>
          </div>

          <div class="row" style="margin-top:16px">
            <button type="button" class="btn secondary" id="prev" disabled>Назад</button>
            <button type="button" class="btn" id="next">Дальше</button>
          </div>
        </form>
      </section>

      <!-- ====== ОТЧЁТ ====== -->
      <section id="result" class="card" style="display:none">
        <div class="title">
          <h2>Карта навыков готова</h2>
          <div class="row">
            <a class="btn" href="/">На главную</a>
            <button class="btn secondary print" onclick="window.print()">Печать / PDF</button>
            <button class="btn secondary" id="reset">Сбросить</button>
          </div>
        </div>

        <!-- KPI по доменам -->
        <div id="kpi" class="kpi" style="margin:10px 0 6px">
          <!-- JS вставит 4 плитки -->
        </div>

        <div class="report">
          <div class="cols">
            <div class="card">
              <h3 style="margin-top:0">Сильные стороны</h3>
              <ul id="strengths" class="muted" style="margin:8px 0 0 18px"></ul>
            </div>
            <div class="card">
              <h3 style="margin-top:0">Зоны для тренировки</h3>
              <ul id="focus" class="muted" style="margin:8px 0 0 18px"></ul>
            </div>
          </div>

          <div class="card">
            <h3 style="margin-top:0">Рекомендации родителю (коротко)</h3>
            <ul id="tips" class="muted" style="margin:8px 0 0 18px">
              <!-- JS подставит 4–6 пунктов -->
            </ul>
          </div>

          <div class="card">
            <h3 style="margin-top:0">Мини-план на 7 дней</h3>
            <ol id="planList" style="margin:8px 0 0 18px"></ol>
            <p class="muted" style="margin-top:8px">План строится на двух направлениях, где сейчас меньше процент. По 10 минут в день, игровая подача.</p>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // ====== ПАРАМЕТРЫ ======
    const STORAGE_KEY = 'azbukid_diag_v2';
    const PLAN_KEY    = 'azbukid_plan_v2';
    const steps = [...document.querySelectorAll('.step')];
    const form = document.getElementById('form');
    const nextBtn = document.getElementById('next');
    const prevBtn = document.getElementById('prev');
    const titleEl = document.getElementById('title');
    const bar = document.getElementById('bar');
    const resultBox = document.getElementById('result');
    const kpiBox = document.getElementById('kpi');
    const strengthsEl = document.getElementById('strengths');
    const focusEl = document.getElementById('focus');
    const tipsEl = document.getElementById('tips');
    const planList = document.getElementById('planList');
    const resetBtn = document.getElementById('reset');
    let i = 0;

    // Макс. баллы по доменам (2 балла за вопрос)
    const MAXIMA = { speech: 10, math: 8, logic: 8, motor: 4 };
    const NAMES  = { speech:'Речь/язык', math:'Счёт/числа', logic:'Логика/внимание', motor:'Графомоторика' };

    function showStep(n){
      steps.forEach((s,idx)=>s.classList.toggle('active', idx===n));
      titleEl.textContent = `Шаг ${n+1} из ${steps.length}`;
      bar.style.width = `${Math.round((n)/steps.length*100)}%`;
      prevBtn.disabled = (n===0);
      nextBtn.textContent = (n===steps.length-1) ? 'Готово' : 'Дальше';
    }
    showStep(i);

    function currentAnswered(){
      const name = `s${i+1}`;
      return form.querySelector(`input[name="${name}"]:checked`);
    }

    nextBtn.addEventListener('click', ()=>{
      if (!currentAnswered()){
        nextBtn.blur();
        nextBtn.classList.add('shake');
        setTimeout(()=>nextBtn.classList.remove('shake'),300);
        return;
      }
      if (i < steps.length-1){ i++; showStep(i); }
      else { finish(); }
    });
    prevBtn.addEventListener('click', ()=>{ if (i>0){ i--; showStep(i);} });

    function band(p){
      if (p <= 50) return {t:'нужна тренировка', cls:'bad'};
      if (p <= 75) return {t:'средний уровень', cls:'warn'};
      return {t:'сильная сторона', cls:'good'};
    }

    function finish(){
      const data = [];
      const totals = {speech:0, math:0, logic:0, motor:0};

      steps.forEach((s,idx)=>{
        const skill = s.dataset.skill;
        const val = parseInt(form.querySelector(`input[name="s${idx+1}"]:checked`).value,10);
        data.push({step:idx+1, skill, val});
        totals[skill] += val;
      });

      // KPI плитки, сильные/фокус
      kpiBox.innerHTML = '';
      const percents = {};
      Object.entries(totals).forEach(([key,score])=>{
        const vmax = MAXIMA[key];
        const p = Math.round(score / vmax * 100);
        percents[key] = p;
        const b = band(p);
        const tile = document.createElement('div');
        tile.className = 'tile';
        tile.innerHTML = `
          <div style="display:flex;align-items:center;justify-content:space-between">
            <strong>${NAMES[key]}</strong>
            <span class="pill ${b.cls}">${b.t}</span>
          </div>
          <div class="muted" style="margin-top:6px">Баллы: <b>${score}</b> из ${vmax} · ${p}%</div>
          <div style="height:8px;background:#1f2937;border-radius:999px;margin-top:8px;overflow:hidden">
            <div style="height:8px;width:${p}%;background:var(--acc)"></div>
          </div>
        `;
        kpiBox.appendChild(tile);
      });

      // Отсортировать домены по % (для сильных и фокуса)
      const sorted = Object.keys(percents).sort((a,b)=>percents[b]-percents[a]);
      const strengths = sorted.filter(k=>percents[k]>75);
      const focus = sorted.filter(k=>percents[k]<=75).reverse().slice(0,2); // 2 слабейших

      strengthsEl.innerHTML = strengths.length
        ? strengths.map(k=>`<li><strong>${NAMES[k]}</strong>: уверенный уровень (${percents[k]}%).</li>`).join('')
        : `<li>Сильные стороны появятся, когда какой-то домен превысит 75%.</li>`;

      focusEl.innerHTML = focus.length
        ? focus.map(k=>`<li><strong>${NAMES[k]}</strong>: стоит потренировать (${percents[k]}%).</li>`).join('')
        : `<li>Зон, требующих усиленной тренировки, не выявлено.</li>`;

      // Рекомендации
      const recLib = {
        speech: [
          'Играйте в «Скажи наоборот» (дом — мод, кот — ток) 2–3 минуты.',
          'Повторяйте скороговорки по слогам и целиком.',
          'Опишите вместе картинку: кто? что делает? где?'
        ],
        math: [
          'Считайте предметы дома до 5/10 в быту.',
          'Игра «Сколько стало?» +1/–1 на пальцах.',
          'Сравнивайте «больше/меньше» на еде/игрушках.'
        ],
        logic: [
          'Игра «Найди лишнее» и объясни почему.',
          'Собирайте простые последовательности (1–4, дни рутины).',
          'Задавайте загадки из 2–3 признаков.'
        ],
        motor: [
          'Обводки по пунктиру крупными линиями.',
          'Рисование кругов/палочек маркером, без спешки.',
          'Пластилин: раскатывать «колбаски», щипковый захват.'
        ]
      };
      tipsEl.innerHTML = sorted.slice(0,4).map(k=>{
        const pick = recLib[k][0];
        return `<li><strong>${NAMES[k]}:</strong> ${pick}</li>`;
      }).join('');

      // Мини-план на 7 дней по двум слабейшим
      const lib = {
        speech:['Игровая артикуляция «лошадка/чашечка» (3 мин)','Повтори слоги: ма-мо-му-мы (3 мин)','Опиши картинку 3 словами (3 мин)'],
        math:['Счёт предметов до 10 (3 мин)','Добавь/убавь один (3 мин)','Сравни длиннее/короче (3 мин)'],
        logic:['Найди лишнее из 4 слов (3 мин)','Продолжи ряд ◯ ■ (3 мин)','Что сначала/потом? (3 мин)'],
        motor:['Обводка широким маркером (3 мин)','Рисуй круги и палочки (3 мин)','Лепи «колбаски» из пластилина (3 мин)']
      };
      const focusOrder = Object.keys(percents).sort((a,b)=>percents[a]-percents[b]);
      const f1 = focusOrder[0], f2 = focusOrder[1];
      const plan = [];
      for (let d=1; d<=7; d++){
        const dom = (d%2===1) ? f1 : f2;
        const pick = lib[dom][(d-1)%lib[dom].length];
        plan.push(`${d}. ${NAMES[dom]} — ${pick}`);
      }
      planList.innerHTML = plan.map(li=>`<li>${li}</li>`).join('');

      // Сохранить
      const payload = { totals, percents, data, ts: Date.now() };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
      localStorage.setItem(PLAN_KEY, JSON.stringify({ plan, ts: Date.now() }));

      // Показать отчёт
      document.querySelector('section.card').style.display='none';
      resultBox.style.display='block';
      bar.style.width = '100%';
      titleEl.textContent = 'Готово';
      nextBtn.disabled = true; prevBtn.disabled = true;
      history.replaceState(null,'','/diagnostics.html#done');
      // Автопрокрутка к началу отчёта
      window.scrollTo({top:0,behavior:'smooth'});
    }

    resetBtn?.addEventListener('click', ()=>{
      localStorage.removeItem(STORAGE_KEY);
      localStorage.removeItem(PLAN_KEY);
      location.href = '/diagnostics.html';
    });

    // Если уже проходили — показать результат по #done
    (function autoload(){
      const saved = localStorage.getItem(STORAGE_KEY);
      const savedPlan = localStorage.getItem(PLAN_KEY);
      if (saved && savedPlan && location.hash==='#done'){
        const { totals, percents } = JSON.parse(saved);
        const { plan } = JSON.parse(savedPlan);

        // KPI
        kpiBox.innerHTML = '';
        Object.keys(MAXIMA).forEach((key)=>{
          const score = totals[key] ?? 0;
          const vmax = MAXIMA[key];
          const p = Math.round((percents?.[key] ?? (score/vmax*100)));
          const b = band(p);
          const tile = document.createElement('div');
          tile.className = 'tile';
          tile.innerHTML = `
            <div style="display:flex;align-items:center;justify-content:space-between">
              <strong>${NAMES[key]}</strong>
              <span class="pill ${b.cls}">${b.t}</span>
            </div>
            <div class="muted" style="margin-top:6px">Баллы: <b>${score}</b> из ${vmax} · ${p}%</div>
            <div style="height:8px;background:#1f2937;border-radius:999px;margin-top:8px;overflow:hidden">
              <div style="height:8px;width:${p}%;background:var(--acc)"></div>
            </div>
          `;
          kpiBox.appendChild(tile);
        });

        // Сильные/фокус
        const prs = percents ?? Object.fromEntries(Object.keys(MAXIMA).map(k=>{
          const score = totals[k]??0; return [k, Math.round(score/MAXIMA[k]*100)];
        }));
        const sorted = Object.keys(prs).sort((a,b)=>prs[b]-prs[a]);
        const strengths = sorted.filter(k=>prs[k]>75);
        const focus = sorted.filter(k=>prs[k]<=75).reverse().slice(0,2);

        strengthsEl.innerHTML = strengths.length
          ? strengths.map(k=>`<li><strong>${NAMES[k]}</strong>: уверенный уровень (${prs[k]}%).</li>`).join('')
          : `<li>Сильные стороны появятся, когда какой-то домен превысит 75%.</li>`;
        focusEl.innerHTML = focus.length
          ? focus.map(k=>`<li><strong>${NAMES[k]}</strong>: стоит потренировать (${prs[k]}%).</li>`).join('')
          : `<li>Зон, требующих усиленной тренировки, не выявлено.</li>`;

        // План
        planList.innerHTML = plan.map(li=>`<li>${li}</li>`).join('');

        // Показ
        document.querySelector('section.card').style.display='none';
        resultBox.style.display='block';
        bar.style.width = '100%';
        titleEl.textContent = 'Готово';
        nextBtn.disabled = true; prevBtn.disabled = true;
      }
    })();
  </script>
</body>
</html>
